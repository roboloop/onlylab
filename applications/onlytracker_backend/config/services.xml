<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services https://symfony.com/schema/dic/services/services-1.0.xsd">
    
    <parameters>
        <parameter key="dump_path" type="string">%kernel.project_dir%/dump</parameter>
        <parameter key="locale" type="string">en</parameter>
    </parameters>
    
    <services>
        <defaults public="false" autowire="false" autoconfigure="true" />

        <!--TODO: REMOVE TO APP CONFIG-->
        <service id="Symfony\Component\Cache\Adapter\NullAdapter" />

        <!--TODO: REMOVE AUTOWIRE. MOVE TO SEPARATED FILE-->
        <prototype namespace="OnlyTracker\BackEnd\Controller\" resource="../src/Controller/*" autowire="true">
            <tag name="controller.service_arguments" />
        </prototype>

        <!--TODO: REMOVE AUTOWIRE. MOVE TO SEPAATED FILE-->
        <prototype namespace="OnlyTracker\BackEnd\Command\" resource="../src/Command/*" exclude="..src/Command/App/*" autowire="true">
            <tag name="console.command" />
        </prototype>

        <service id="OnlyTracker\Infrastructure\BackupManager\DatabaseManager">
            <argument id="backup_manager" type="service"/>
        </service>

        <service id="OnlyTracker\Infrastructure\Doctrine\Strategy\UnderscorePluralStrategy">
            <argument type="constant">CASE_LOWER</argument>
        </service>
        <service id="OnlyTracker\Infrastructure\BackupManager\MysqlDatabase" />
        <service id="backup_manager.databases" class="BackupManager\Databases\DatabaseProvider">
            <argument type="service" id="backup_manager.config_database" />
            <call method="add">
                <argument type="service" id="OnlyTracker\Infrastructure\BackupManager\MysqlDatabase" />
            </call>
        </service>

        <!--Infrastructure utils-->
        <service id="OnlyTracker\Infrastructure\Util\DateTimeUtil" />
        <service id="OnlyTracker\Domain\Shared\DateTimeUtilInterface" alias="OnlyTracker\Infrastructure\Util\DateTimeUtil" />

        <!--Infrastructure utils parsers-->
        <service id="OnlyTracker\Infrastructure\Util\Parser\Title\GenreParser" />
        <service id="OnlyTracker\Infrastructure\Util\Parser\Title\OriginalTitleParser" />
        <service id="OnlyTracker\Infrastructure\Util\Parser\Title\QualityParser" />
        <service id="OnlyTracker\Infrastructure\Util\Parser\Title\StudioParser" />
        <service id="OnlyTracker\Infrastructure\Util\Parser\Title\YearParser" />
        <service id="OnlyTracker\Infrastructure\Util\Parser\Title\TitleParserManager">
            <argument type="service" id="OnlyTracker\Infrastructure\Util\Parser\Title\GenreParser" />
            <argument type="service" id="OnlyTracker\Infrastructure\Util\Parser\Title\OriginalTitleParser" />
            <argument type="service" id="OnlyTracker\Infrastructure\Util\Parser\Title\QualityParser" />
            <argument type="service" id="OnlyTracker\Infrastructure\Util\Parser\Title\StudioParser" />
            <argument type="service" id="OnlyTracker\Infrastructure\Util\Parser\Title\YearParser" />
        </service>

        <!--Hydrator-->
        <service id="OnlyTracker\Shared\Infrastructure\Util\Hydrator\HydratorInterface" alias="OnlyTracker\Shared\Infrastructure\Util\Hydrator\Hydrator" />
        <service id="OnlyTracker\Shared\Infrastructure\Util\Hydrator\Hydrator" />

        <!--ArgumentResolver-->
        <service id="OnlyTracker\Shared\Infrastructure\Symfony\ArgumentResolver\ArgumentValueDtoResolver">
            <argument type="service" id="OnlyTracker\Shared\Infrastructure\Util\Hydrator\HydratorInterface" />
            <argument type="service" id="validator" />
        </service>

        <!--Http Kernel Listeners -->
        <service id="OnlyTracker\Shared\Infrastructure\Symfony\JsonRequestListener" />
        <service id="OnlyTracker\Shared\Infrastructure\Symfony\ErrorResponseListener" />

        <!--Original deduction -->
        <service id="OnlyTracker\Domain\Deduction\FastpicDeduction">
            <tag name="only_tracker.domain.deduction.original_url_deduction.tag" />
        </service>

        <service id="OnlyTracker\Domain\Deduction\PicshickDeduction">
            <tag name="only_tracker.domain.deduction.original_url_deduction.tag" />
        </service>

        <service id="OnlyTracker\Domain\Deduction\OriginalUrlDeduction">
            <argument type="tagged_iterator" tag="only_tracker.domain.deduction.original_url_deduction.tag" />
        </service>
        <service id="OnlyTracker\Domain\Deduction\OriginalUrlDeductionInterface" alias="OnlyTracker\Domain\Deduction\OriginalUrlDeduction" />


        <!--Domain repositories-->
        <service id="OnlyTracker\Domain\Repository\ForumRepositoryInterface" alias="OnlyTracker\Infrastructure\Doctrine\Repository\ForumDoctrineRepository" />
        <service id="OnlyTracker\Domain\Repository\GenreRepositoryInterface" alias="OnlyTracker\Infrastructure\Doctrine\Repository\GenreDoctrineRepository" />
        <service id="OnlyTracker\Domain\Repository\ImageRepositoryInterface" alias="OnlyTracker\Infrastructure\Doctrine\Repository\ImageDoctrineRepository" />
        <service id="OnlyTracker\Domain\Repository\StudioRepositoryInterface" alias="OnlyTracker\Infrastructure\Doctrine\Repository\StudioDoctrineRepository" />
        <service id="OnlyTracker\Domain\Repository\TopicRepositoryInterface" alias="OnlyTracker\Infrastructure\Doctrine\Repository\TopicDoctrineRepository" />

        <!--Infrastructure repositories-->
        <service id="OnlyTracker\Infrastructure\Doctrine\Repository\ForumDoctrineRepository">
            <argument type="service" id="doctrine.orm.default_entity_manager" />
        </service>

        <service id="OnlyTracker\Infrastructure\Doctrine\Repository\GenreDoctrineRepository">
            <argument type="service" id="doctrine.orm.default_entity_manager" />
        </service>

        <service id="OnlyTracker\Infrastructure\Doctrine\Repository\ImageDoctrineRepository">
            <argument type="service" id="doctrine.orm.default_entity_manager" />
        </service>

        <service id="OnlyTracker\Infrastructure\Doctrine\Repository\StudioDoctrineRepository">
            <argument type="service" id="doctrine.orm.default_entity_manager" />
        </service>

        <service id="OnlyTracker\Infrastructure\Doctrine\Repository\TopicDoctrineRepository">
            <argument type="service" id="doctrine.orm.default_entity_manager" />
        </service>

        <!--Domain Factories-->
        <service id="OnlyTracker\Domain\Factory\ForumFactory">
            <argument type="service" id="OnlyTracker\Infrastructure\Util\DateTimeUtil" />
        </service>

        <service id="OnlyTracker\Domain\Factory\GenreFactory">
            <argument type="service" id="OnlyTracker\Domain\Repository\GenreRepositoryInterface" />
            <argument type="service" id="OnlyTracker\Infrastructure\Util\DateTimeUtil" />
        </service>

        <service id="OnlyTracker\Domain\Factory\ImageFactory">
            <argument type="service" id="OnlyTracker\Domain\Repository\ImageRepositoryInterface" />
            <argument type="service" id="OnlyTracker\Infrastructure\Util\DateTimeUtil" />
        </service>

        <service id="OnlyTracker\Domain\Factory\ParsedTitleFactory" />

        <service id="OnlyTracker\Domain\Factory\StudioFactory">
            <argument type="service" id="OnlyTracker\Domain\Repository\StudioRepositoryInterface" />
            <argument type="service" id="OnlyTracker\Infrastructure\Util\DateTimeUtil" />
        </service>

        <service id="OnlyTracker\Domain\Factory\TopicFactory">
            <argument type="service" id="OnlyTracker\Infrastructure\Util\DateTimeUtil" />
        </service>

        <!--Domain services-->
        <service id="OnlyTracker\Domain\Service\ForumService">
            <argument type="service" id="OnlyTracker\Infrastructure\Doctrine\Repository\ForumDoctrineRepository" />
            <argument type="service" id="OnlyTracker\Domain\Factory\ForumFactory" />
        </service>

        <service id="OnlyTracker\Domain\Service\GenreService">
            <argument type="service" id="OnlyTracker\Infrastructure\Doctrine\Repository\GenreDoctrineRepository" />
            <argument type="service" id="OnlyTracker\Domain\Factory\GenreFactory" />
        </service>

        <service id="OnlyTracker\Domain\Service\ImageService">
            <argument type="service" id="OnlyTracker\Infrastructure\Doctrine\Repository\ImageDoctrineRepository" />
            <argument type="service" id="OnlyTracker\Domain\Factory\ImageFactory" />
            <argument type="service" id="OnlyTracker\Domain\Deduction\OriginalUrlDeductionInterface" />
        </service>

        <service id="OnlyTracker\Domain\Service\ParsedTitleService">
            <argument type="service" id="OnlyTracker\Domain\Factory\ParsedTitleFactory" />
            <argument type="service" id="OnlyTracker\Infrastructure\Util\Parser\Title\TitleParserManager" />
        </service>
        
        <service id="OnlyTracker\Domain\Service\SpoilerIdentifier" />

        <service id="OnlyTracker\Domain\Service\StudioService">
            <argument type="service" id="OnlyTracker\Infrastructure\Doctrine\Repository\StudioDoctrineRepository" />
            <argument type="service" id="OnlyTracker\Domain\Factory\StudioFactory" />
        </service>

        <service id="OnlyTracker\Domain\Service\TopicService">
            <argument type="service" id="OnlyTracker\Infrastructure\Doctrine\Repository\TopicDoctrineRepository" />
            <argument type="service" id="OnlyTracker\Domain\Factory\TopicFactory" />
            <argument type="service" id="OnlyTracker\Domain\Service\ParsedTitleService" />
        </service>

        <service id="OnlyTracker\Domain\Service\TopicDeletion">
            <argument type="service" id="OnlyTracker\Infrastructure\Doctrine\Repository\TopicDoctrineRepository"/>
            <argument type="service" id="OnlyTracker\Infrastructure\Doctrine\Repository\ImageDoctrineRepository"/>
        </service>


        <!--Application-->
        <service id="OnlyTracker\Application\Parser\ForumHtmlParser" />
        <service id="OnlyTracker\Application\Parser\TopicHtmlParser" />
        <service id="OnlyTracker\Application\Creator\TopicCreator">
            <argument type="service" id="validator"/>
            <argument type="service" id="OnlyTracker\Infrastructure\Util\Parser\Title\TitleParserManager"/>
            <argument type="service" id="OnlyTracker\Domain\Service\GenreService"/>
            <argument type="service" id="OnlyTracker\Domain\Service\StudioService"/>
            <argument type="service" id="OnlyTracker\Domain\Service\ForumService"/>
            <argument type="service" id="OnlyTracker\Domain\Service\TopicService"/>
            <argument type="service" id="OnlyTracker\Domain\Service\ImageService"/>
            <argument type="service" id="OnlyTracker\Infrastructure\Util\DateTimeUtil"/>
            <argument type="service" id="OnlyTracker\Domain\Repository\TopicRepositoryInterface"/>
        </service>

        <service id="OnlyTracker\Shared\Application\Search\QuerySearchHandler"/>


    </services>
</container>
